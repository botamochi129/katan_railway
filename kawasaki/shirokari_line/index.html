<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="城刈線の路線紹介ページです。沿線の駅情報や運行情報をご案内します。">
  <title>城刈線 | 勝炭鉄道</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../../index.css">
  <link rel="icon" href="../../favicon.ico">
</head>
<body>
  <!-- ヘッダー読み込み -->
  <div id="header-container"></div>

  <main>
    <h1>城刈線</h1>
    <p>城刈線の路線説明などをここに書きます。</p>

    <!-- 駅一覧 -->
    <section id="stations">
      <h2>駅一覧</h2>
      <ul id="station-list" class="branch-container"></ul>
    </section>

    <!-- 駅情報 -->
    <section id="station-info-section">
      <h2>駅情報</h2>
      <div id="station-info"></div>
    </section>

    <p><a class="btn" href="../index.html">支部トップに戻る</a></p>
  </main>

  <!-- フッター読み込み -->
  <div id="footer-container"></div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    // ヘッダー・フッター読み込み
    fetch('../../header.html')
      .then(r => r.text())
      .then(t => document.getElementById('header-container').innerHTML = t);

    fetch('../../footer.html')
      .then(r => r.text())
      .then(t => document.getElementById('footer-container').innerHTML = t);

    // 駅情報のJSON読み込み
    async function loadStations() {
      const res = await fetch('stations.json');
      const stations = await res.json();

      const params = new URLSearchParams(window.location.search);
      const stationId = params.get('id') || stations[0].id;

      const station = stations.find(s => s.id === stationId);

      if (!station) {
        document.getElementById('station-info').innerHTML = '<p>駅が見つかりません</p>';
        return;
      }

      // prev処理
      let prevHTML = 'なし';
      if (station.prev) {
        if (Array.isArray(station.prev)) {
          prevHTML = station.prev.map(id => {
            const s = stations.find(st => st.id === id);
            return s ? `<a href="?id=${id}">${s.name}</a>` : '';
          }).join(' / ');
        } else {
          const s = stations.find(st => st.id === station.prev);
          prevHTML = s ? `<a href="?id=${station.prev}">${s.name}</a>` : 'なし';
        }
      }

      // next処理
      let nextHTML = 'なし';
      if (station.next) {
        if (Array.isArray(station.next)) {
          nextHTML = station.next.map(id => {
            const s = stations.find(st => st.id === id);
            return s ? `<a href="?id=${id}">${s.name}</a>` : '';
          }).join(' / ');
        } else {
          const s = stations.find(st => st.id === station.next);
          nextHTML = s ? `<a href="?id=${station.next}">${s.name}</a>` : 'なし';
        }
      }

      // 駅情報表示
      document.getElementById('station-info').innerHTML = `
        <h3>${station.name}</h3>
        <p>ID: ${station.id}</p>
        <p>前の駅: ${prevHTML}<br>次の駅: ${nextHTML}</p>
      `;

      // 駅一覧リンク
      const listEl = document.getElementById('station-list');
      listEl.innerHTML = stations.map(s => `<li class="branch-card"><a href="?id=${s.id}">${s.name}</a></li>`).join('');
    }

    loadStations();
  });
  </script>
</body>
</html>
