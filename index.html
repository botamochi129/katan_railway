<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="勝炭鉄道の公式ウェブサイト。沿線の魅力や運行情報をご案内します。">
    <title>勝炭鉄道株式会社</title>
    <link rel="stylesheet" href="index.css">
    <link rel="icon" href="favicon.ico">
</head>
<body>
    <!-- 共通ヘッダーを挿入 -->
    <div id="header-container"></div>

    <main>
        <!-- スライダー -->
        <section id="hero">
            <div class="slider">
                <div class="slide active">
                    <img src="image/slide1.jpg" alt="沿線風景1">
                    <div class="caption">未来をつなぐ、地域を育む。</div>
                </div>
                <div class="slide">
                    <img src="image/slide2.jpg" alt="沿線風景2">
                    <div class="caption">快適で安全な鉄道サービス。</div>
                </div>
                <div class="slide">
                    <img src="image/slide3.jpg" alt="沿線風景3">
                    <div class="caption">沿線の魅力をお届けします。</div>
                </div>
            </div>
        </section>

        <section id="updates">
            <h2>最新情報</h2>
            <div class="info-cards" id="updates-container">
                <!-- JSONから読み込んだ最新5件がここに挿入されます -->
            </div>
            <div class="view-all">
                <a href="info.html">すべて見る &raquo;</a>
            </div>
        </section>

        <section id="branches">
            <h2>沿線・支部案内</h2>
            <div class="branch-container">
                <a href="katan/stations/index.html" class="branch-card">
                    <img src="image/katan_map.png" alt="勝炭本部">
                    <span>勝炭本部</span>
                </a>
        
                <a href="fukamiya/stations/index.html" class="branch-card">
                    <img src="image/fukamiya_map.png" alt="深宮支部">
                    <span>深宮支部</span>
                </a>
        
                <a href="kawasaki/stations/index.html" class="branch-card">
                    <img src="image/kawasaki_map.png" alt="川前支部">
                    <span>川前支部</span>
                </a>
            </div>
        </section>

        <section id="about">
            <h2>会社概要</h2>
            <p>勝炭鉄道株式会社は、勝炭県に本社を構え、深宮県(深宮鯖)と川前府(MJaS)に支部を置く架空の鉄道会社です。</p>
        </section>

        <section id="recruit">
            <h2>採用情報</h2>
            <p>勝炭鉄道では、共に未来を創る仲間を募集しています。詳細は採用ページをご覧ください。</p>
        </section>

        <section id="contact">
            <h2>お問い合わせ</h2>
            <p>ご質問やご意見がございましたら、お気軽にお問い合わせください。</p>
        </section>

        <section id="announce">
            <h2>放送について</h2>
            <p>放送では、音声は(動画制作会社VIDWEB)[https://vidweb.co.jp/]のボイスゲートを利用しています</p>
        </section>
    </main>

    <!-- 共通フッターを挿入 -->
    <div id="footer-container"></div>

    <!-- スライダー用スクリプト -->
    <script>
        // ヘッダー読み込み
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
            });

        // フッター読み込み
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });
        
        let currentSlide = 0;
        const slides = document.querySelectorAll(".slide");

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle("active", i === index);
            });
        }

        setInterval(() => {
            currentSlide = (currentSlide + 1) % slides.length;
            showSlide(currentSlide);
        }, 5000);

        async function loadUpdates() {
            try {
                const [newsRes, eventsRes] = await Promise.all([
                    fetch('data/news.json'),
                    fetch('data/events.json')
                ]);
                const news = await newsRes.json();
                const events = await eventsRes.json();
    
                const updates = [...news.map(item => ({...item, type: 'ニュース'})),
                                 ...events.map(item => ({...item, type: 'イベント'}))];
    
                updates.sort((a, b) => new Date(b.date) - new Date(a.date));
    
                const container = document.getElementById('updates-container');
    
                updates.slice(0, 5).forEach(item => { // 最新5件だけ表示
                    const card = document.createElement('div');
                    card.className = 'card ' + (item.type === 'ニュース' ? 'news-card' : 'event-card');
                    card.innerHTML = `
                        <h3>${item.date} - ${item.title} <span class="type">[${item.type}]</span></h3>
                        <p>${item.content}</p>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error("最新情報の読み込みに失敗しました:", error);
            }
        }
    
        loadUpdates();

        const branchCards = document.querySelectorAll('.branch-card');
        
        branchCards.forEach(card => {
            const newsFile = card.dataset.news;
            fetch(`data/news_${newsFile}.json`)
                .then(res => res.json())
                .then(news => {
                    const ul = card.querySelector('.branch-news');
                    news.slice(0, 3).forEach(item => {  // 最新3件表示
                        const li = document.createElement('li');
                        li.textContent = `${item.date} - ${item.title}`;
                        ul.appendChild(li);
                    });
                });
        });

    </script>
</body>
</html>
